/*
 *  Draw me a kanji - v0.1.0
 *  A funny drawer for your Japanese writings
 *  https://github.com/mbilbille/dmak
 *
 *  Made by Matthieu Bilbille
 *  Under MIT License
 */
!function(){"use strict";var a=function(b,c){if(this.text=b,this.options=g(a.options,c),this.strokes=[],this.papers=[],this.pointer=0,this.timeouts=[],!this.options.skipLoad){var d=new DmakLoader(this.options.uri);d.load(b,function(a){this.setStrokes(a),this.options.loaded(this.strokes)}.bind(this))}};a.VERSION="0.1",a.options={uri:"",skipLoad:!1,height:109,width:109,step:.03,duration:750,element:"draw",stroke:{animated:!0,attr:{active:"#F92672",stroke:"#272822","stroke-width":3,"stroke-linecap":"round","stroke-linejoin":"round"}},grid:{show:!0,attr:{stroke:"#CCCCCC","stroke-width":.5,"stroke-dasharray":"--"}},loaded:function(){},erased:function(){},drew:function(){}},a.fn=a.prototype={setStrokes:function(a){this.strokes=b(a),this.papers=c(a.length),this.options.grid.show&&d(this.papers)},erase:function(a){if(this.timeouts.length)return!1;if(this.pointer<=0)return!1;"undefined"==typeof a&&(a=0);do this.pointer--,this.strokes[this.pointer].object.remove(),this.strokes[this.pointer].object=null,this.options.erased(this.pointer);while(this.pointer>a)},render:function(a){if(this.timeouts.length)return!1;if("undefined"==typeof a)a=this.strokes.length;else if(a>this.strokes.length)return!1;for(var b=0,c=this.pointer;a>c;c++){var d=setTimeout(function(a){e(a.papers[a.strokes[a.pointer].char],a.strokes[a.pointer]),a.pointer++,a.timeouts.shift(),a.options.drew(a.pointer)},b,this);b+=this.strokes[c].duration,this.timeouts.push(d)}},pause:function(){for(var a=0;a<this.timeouts.length;a++)window.clearTimeout(this.timeouts[a]);this.timeouts=[]},eraseLastStrokes:function(a){this.erase(this.pointer-a)},renderNextStrokes:function(a){this.render(this.pointer+a)}};var b=function(b){for(var c=[],d=0;d<b.length;d++)for(var e=0;e<b[d].length;e++){var f=Raphael.getTotalLength(b[d][e]),g={"char":d,length:f,duration:f*a.options.step*1e3,path:b[d][e],object:null};c.push(g)}return c},c=function(b){for(var c=[],d=0;b>d;d++){var e=new Raphael(a.options.element,a.options.width+"px",a.options.height+"px");e.canvas.setAttribute("class","dmak-svg"),c.push(e)}return c.reverse()},d=function(b){for(var c=0;c<b.length;c++)b[c].path("M"+a.options.width/2+",0 L"+a.options.width/2+","+a.options.height).attr(a.options.grid.attr),b[c].path("M0,"+a.options.height/2+" L"+a.options.width+","+a.options.height/2).attr(a.options.grid.attr)},e=function(b,c){c.object=b.path(c.path),c.object.attr(a.options.stroke.attr),a.options.stroke.animated&&f(c)},f=function(b){b.object.attr({stroke:a.options.stroke.attr.active}),b.object.node.style.transition=b.object.node.style.WebkitTransition="none",b.object.node.style.strokeDasharray=b.length+" "+b.length,b.object.node.style.strokeDashoffset=b.length,b.object.node.getBoundingClientRect(),b.object.node.style.transition=b.object.node.style.WebkitTransition="stroke-dashoffset "+b.duration+"ms ease",b.object.node.style.strokeDashoffset="0",setTimeout(function(){null!=b.object&&(b.object.node.style.stroke=a.options.stroke.attr.stroke,b.object.node.style.transition=b.object.node.style.WebkitTransition="stroke 400ms ease")},b.duration)},g=function(a,b){if(2!=arguments.length)throw new Error("Missing arguments in extend function");var c=a;for(var d in b)"object"==typeof c[d]?c[d]=g(c[d],b[d]):c.hasOwnProperty(d)&&(c[d]=b[d]);return c};window.Dmak=a}(),function(){"use strict";function a(a,c,d,e){var f=new XMLHttpRequest;f.open("GET",a+"0"+d+".svg",!0),f.onreadystatechange=function(){4===f.readyState&&(200===f.status?e.done(c,b(f.response)):e.error(f.statusText))},f.send()}function b(a){for(var b=new DOMParser,c=b.parseFromString(a,"application/xml").querySelectorAll("path"),d=[],e=0;e<c.length;e++)d.push(c[e].getAttribute("d"));return d}var c=function(a){this.uri=a};c.prototype.load=function(b,c){for(var d=0,e=[],f=b.length,d=0,g=0;f>g;g++)a(this.uri,g,b.charCodeAt(g).toString(16),{done:function(a,b){e[a]=b,d++,d===f&&c(e)},error:function(a){console.log("Error",a)}})},window.DmakLoader=c}();